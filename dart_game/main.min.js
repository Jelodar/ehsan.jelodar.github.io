var all_width,all_height,canvas_width,canvas_height,canvas,context,power_interval,hover_interval,dart_location_x,dart_location_y,canvas_offset_left,canvas_offset_top,isWin,dart,next_btn,refresh_btn,Create_balloons_interval,parent_1,parent_2,balloon_tmp,power=1,power_dir=1,power_fps=100,gameIsReady=!1,balloonsCreated=!1,dartJaculation=!1,main_frame_interval=!1,image_count=7,image_loaded_count=0,balloon_width=65,balloon_height=87,Level=1,Lose=0,Score=0,Score_time=0,dart_degree=0,dart_movement_speed=0,initial_jaculation_cycle=!1,gravity=1,jaculation_degree=0,dart_location_tmp_x=0,dart_location_tmp_y=0,Gravity_ratio=.6,server_error_text="Unable to connect server",Const_value_ratio=250,Score_value_ratio=1,FPS=30;function ResetValue(){initial_jaculation_cycle=!1,dartJaculation=!1,isHovered_btn=!1,gravity=1,SetPower(),Start_Level()}var balloons=[];function Start_Level(){dart_location_x=dart_Location_Created[0],dart_location_y=dart_Location_Created[1];for(var t=0;t<balloons_Location_Created.length;t++){var o=balloons_Location_Created[t];balloons[t]=new balloon(o.x-balloon_width/2,o.y-balloon_height/2,"images/b"+(t+1)+".png",!1)}(dart=new Image).src="images/d5.png",(next_btn=new Image).src="images/next.png",(refresh_btn=new Image).src="images/refresh.png"}var cursor_x=0,cursor_y=0;function move(t){cursor_x=(t=t||event).pageX,cursor_y=t.pageY}function refresh_black(){context.beginPath(),context.fillStyle="rgba(0,0,0,1)",context.rect(0,0,canvas_width,canvas_height),context.fill(),context.closePath()}function balloon(t,o,e,a){this.x=t,this.y=o,this.img=new Image,this.img.src=e,this.pop=a,this.changePop=function(t){this.pop=t}}function Enter_game(){Start_creation_with_GA(),function t(){balloonsCreated?(ResetValue(),initial(),Start_game()):(WaitForGameReady(),setTimeout(t,50))}()}function Start_game(){Score_time=new Date().getTime(),main_frame_interval=setInterval(function(){gameIsReady?(refresh_black(),powerAnimation(),showInfo(),DrawBalloon(),dartAnimation()):WaitForGameReady()},FPS)}function powerAnimation(){var t=canvas_height-110;context.beginPath(),context.strokeStyle="#BDC7D1",context.lineWidth=1,context.rect(10,t,5,100),context.stroke(),context.closePath();for(var o=0;o<power;o++){var e=canvas_height-20-10*o;context.beginPath(),context.fillStyle="rgb(100"+parseInt(20*o)+","+Math.abs(200-parseInt(20*o))+",0)",context.fillRect(10,e,4,9),context.closePath()}}function DrawBalloon(){for(var t=0;t<balloons.length;t++){var o=balloons[t];o.pop||(context.beginPath(),context.drawImage(o.img,o.x,o.y),context.closePath())}}function dartAnimation(){dartJaculation?(gravity+=Gravity_ratio,initial_jaculation_cycle||(jaculation_degree=dart_degree,dart_movement_speed=Math.max(2.6*power,2)),dart_location_x-=Math.cos(jaculation_degree)*dart_movement_speed,dart_location_y-=Math.sin(jaculation_degree)*dart_movement_speed,dart_location_y+=gravity,dart_degree=Math.atan2(dart_location_x-dart_location_tmp_x,-(dart_location_y-dart_location_tmp_y)),checkBalloonPop(),checkGameOver(),initial_jaculation_cycle=!0):dart_degree=Math.atan2(cursor_x-(dart_location_x+canvas_offset_left),-(cursor_y-(dart_location_y+canvas_offset_top))),dart_degree-=130.45,context.save(),context.translate(dart_location_x,dart_location_y),context.rotate(dart_degree),context.drawImage(dart,-40,-12),context.restore(),dart_location_tmp_x=dart_location_x,dart_location_tmp_y=dart_location_y}function initial(){dart.onload=function(){image_loaded_count++},next_btn.onload=function(){image_loaded_count++},refresh_btn.onload=function(){image_loaded_count++};for(var t=0;t<balloons.length;t++)balloons[t].img.onload=function(){image_loaded_count++};!function t(){image_count==image_loaded_count?gameIsReady=!0:setTimeout(t,500)}()}function checkBalloonPop(){for(var t=0;t<balloons.length;t++){var o=balloons[t];if(!1==o.pop){var e=o.x,a=o.x+balloon_width,n=o.y,i=o.y+balloon_height;dart_location_x>e&&dart_location_x<a&&dart_location_y>n&&dart_location_y<i&&(o.pop=!0)}}}function checkGameOver(){if(dart_location_y>canvas_height){isWin=!0;for(var t=0;t<balloons.length;t++)if(!1==balloons[t].pop){isWin=!1;break}EndLevel()}}function SetPower(){power_interval=setInterval(function(){(10==power||0==power)&&(power_dir=-power_dir),power+=power_dir},power_fps)}function WaitForGameReady(){refresh_black(),context.beginPath(),context.fillStyle="#CC210E",context.font="30px sans-serif",context.fillText("Please Wait ...",canvas_width/2.8,canvas_height/2-20),context.closePath()}function showInfo(){context.beginPath(),context.fillStyle="#33C72E",context.font="20px sans-serif",context.fillText("Level "+Level,10,25),context.fillStyle="#E0DD10",context.fillText("Lose : "+Lose,canvas_width/2-50,25),context.fillStyle="#1FC4E5";var t=Score<1e3?canvas_width-110:canvas_width-130;context.fillText("Score : "+Score,t,25),context.fillStyle="#FF341A",context.font="12px sans-serif";var o=parseInt((new Date().getTime()-Score_time)/1e3);context.fillText("Time Elapsed : "+o,canvas_width-110,canvas_height-15),context.closePath()}function EndLevel(){var t="You Lose",o="#E60000",e=refresh_btn;isWin&&(t="You Win",o="#4BE642",e=next_btn);var a=canvas_width/3+35,n=canvas_height/2-20,i=a-38,l=n-31;context.beginPath(),!isHovered_btn&&(StopRendering(),context.fillStyle="rgba(0,0,0,0.3)",context.fillRect(0,0,canvas_width,canvas_height),hover_interval=setInterval(function(){checkBtnHover(i,l,200,100)},100),isWin)&&(Score+=parseInt(5e4/(new Date().getTime()-Score_time)))>250&&$.get("",{score_ratio_set:Const_value_ratio}).done(function(t){Const_value_ratio*=2}).fail(function(){}),context.fillStyle="#000000",context.fillRect(i,l,200,100),context.fillStyle=o,context.font="30px sans-serif",context.fillText(t,a,n),context.drawImage(e,a+40,n+20),context.closePath()}function StopRendering(){clearInterval(main_frame_interval),main_frame_interval=!1}document.onmousemove=move,$().ready(function(){all_width=Math.max($(document).width(),$(window).width()),all_height=Math.max($(document).height(),$(window).height()),context=(canvas=document.getElementById("animation-canvas")).getContext("2d"),canvas_width=canvas.width,canvas_height=canvas.width,canvas_offset_left=canvas.offsetLeft,canvas_offset_top=canvas.offsetTop,$("#Start_game_btn").click(function(){power_fps=$("#intensity_select").val(),$("#start_btn_container").fadeOut(500),$("#title_initial").fadeOut(500),$("#high-score-container").fadeIn(500),Enter_game()}),$("#stop").click(function(){StopRendering()}),$("#animation-canvas").click(function(){!1!=main_frame_interval&&(dartJaculation=!0,clearInterval(power_interval))})});var checkEndLevelAction=function(){clearInterval(hover_interval),checkBtnHover(),isWin?(Level++,balloonsCreated=!1,Enter_game()):(Lose++,ResetValue(),Start_game())},isHovered_btn=!1;function checkBtnHover(t,o,e,a){cursor_x-canvas_offset_left>t&&cursor_x-canvas_offset_left<t+e&&cursor_y-canvas_offset_top>o&&cursor_y-canvas_offset_top<o+a?isHovered_btn||(canvas.addEventListener?canvas.addEventListener("click",checkEndLevelAction,!1):canvas.attachEvent&&canvas.attachEvent("onclick",checkEndLevelAction),context.beginPath(),context.fillStyle="rgba(255, 255, 255, 0.09)",context.fillRect(t,o,e,a),context.closePath(),isHovered_btn=!0):isHovered_btn&&(EndLevel(),canvas.removeEventListener?canvas.removeEventListener("click",checkEndLevelAction,!1):canvas.detachEvent&&canvas.detachEvent("onclick",checkEndLevelAction),isHovered_btn=!1)}var Creation_FPS=50,dart_location=[],balloons_location=[],costs=[],dart_location_num=20,max_ballon_buffer=1e3,balloons_Location_Created=[],dart_Location_Created=[];function Create_dart_location(){for(var t=0;t<dart_location_num;t++)dart_location.push(Random_dart_location())}function Create_population(){(balloons_location=[])[0]=[new balloon_fake(getPopulation()),new balloon_fake(getPopulation()),new balloon_fake(getPopulation()),new balloon_fake(getPopulation())],balloons_location[1]=[new balloon_fake(getPopulation()),new balloon_fake(getPopulation()),new balloon_fake(getPopulation()),new balloon_fake(getPopulation())],balloons_location[2]=[new balloon_fake(getPopulation()),new balloon_fake(getPopulation()),new balloon_fake(getPopulation()),new balloon_fake(getPopulation())],balloons_location[3]=[new balloon_fake(getPopulation()),new balloon_fake(getPopulation()),new balloon_fake(getPopulation()),new balloon_fake(getPopulation())]}function Random_dart_location(){var t=getRnd(),o=getRnd();return[t,o]}function getRnd(){return parseInt(400*Math.random())+100}function getPopulation(){return[getRnd(),getRnd()]}function balloon_fake(t){this.x=parseInt(t[0]),this.y=parseInt(t[1])}function Start_creation_with_GA(){Create_dart_location(),Create_population(),Create_balloons_interval=setInterval(function(){for(var t=0;t<dart_location.length&&!checkItem(dart_location[t]);t++);balloons_location.length>max_ballon_buffer&&Create_population()},Creation_FPS)}function checkItem(t){costs=[];for(var o=t[0],e=t[1],a=Math.atan2(o-2,-(e-canvas_height))*(180/Math.PI),n=0;n<balloons_location.length;n++){for(var i,l=0,r=0,c=balloons_location[n],s=0;s<c.length;s++){var d=c[s].x,v=c[s].y,f=o,h=e;s>0&&(f=c[s-1].x,h=c[s-1].y);var p=Math.atan2(d-f,-(v-h))*(180/Math.PI);if(0==s&&(i=p<0?-1:1),s>0){if(1==i){if(r=Math.max(r,a),p>90){var u=d-f;r=u<balloon_width?r:Math.max(r+u-balloon_width,180)}(p<0||p<r+0)&&l++}else{if(r=Math.min(r,a),p<-90){var u=f-d;r=u<balloon_width?r:Math.max(r-u+balloon_width,-180)}(p>0||p>r-0)&&l++}}a=p}if(0==l)return clearInterval(Create_balloons_interval),dart_Location_Created=[o,e],balloons_Location_Created=balloons_location[n],balloonsCreated=!0,!0;costs[n]=new balloon_cost(balloons_location[n],l)}return selectParent(),!1}function balloon_cost(t,o){this.balloon=t,this.cost=o}function selectParent(){costs.sort(function(t,o){return t.cost-o.cost}),parent_1=costs[0].balloon,parent_2=costs[1].balloon,crossover()}function crossover(){balloon_tmp=[];for(var t=[],o=0;o<parent_1.length;o++){var e=parent_1[o].x,a=parent_2[o].y;t.push(new balloon_fake([e,a]))}balloon_tmp.push(t),t=[];for(var o=0;o<parent_2.length;o++){var e=parent_2[o].x,a=parent_1[o].y;t.push(new balloon_fake([e,a]))}balloon_tmp.push(t),mutation()}function mutation(){for(var t=0;t<2;t++){for(var o=balloon_tmp[t],e=0;e<o.length;e++)o[e].x=parseInt(Math.min(Math.abs(o[e].x+20*Math.cos(Math.random()*Math.PI)),canvas_width-10)),o[e].y=parseInt(Math.min(Math.abs(o[e].x+20*Math.cos(Math.random()*Math.PI)),canvas_height-10));balloons_location.push(o)}}$(document).on("click","#show-details-close-popup-btn",function(){$("#ej-popup-close-btn").click()});var EJ_POPUP_LAST_SCROLL_TOP=0;function ej_popup(){this.isShow=!1,this.loading=function(t){var o=$(document).scrollTop();$("#ej-popup-html").html("<div class='ej-loading-overlay-area'></div>"),$("#ej-popup-container").css("display","block");var e=t?EJ_POPUP_LAST_SCROLL_TOP:o+60;EJ_POPUP_LAST_SCROLL_TOP=e,$("#ej-popup").css("top",e+"px").fadeIn(200),this.isShow=!0},this.fadeIn=function(t){$("#ej-popup-html").html(t)},this.fadeOut=function(){$("#ej-popup-container").css("display","none"),$("#ej-popup").fadeOut(200),this.isShow=!1}}var EJ_POPUP=new ej_popup;$().ready(function(){function t(t,o){EJ_POPUP.loading(!1),$.get("",{get_rate_detail:1}).done(function(e){var a="<table id='history-table'><tr><th>Rank</th><th>Name</th><th>Score</th><th>Lose</th><th>Level</th></tr>",n=JSON.parse(e),i=255,l=40,r=255,c=o||0,s=parseInt(i/10),d=parseInt(l/10),v=parseInt(r/10);for(var f in n){var h=n[f].name||"Unknown",p=n[f].score,u=n[f].lose,b=n[f].level,g=n[f].id==c;i=Math.max(i-s,0),l=Math.max(l-d,0),r=Math.max(r-v,60);var m=g?"background: rgb(5,65,221); color: #DDD;":"background: rgb("+i+",0,"+l+"); color: rgb("+r+","+r+","+r+");",x=g?"":"color: rgb("+i+","+r+","+l+");";a+="<tr style=' "+m+" '><td>"+(parseInt(f)+1)+"</td><td class='history-name'>"+h+"</td><td><b style='"+x+"'>"+p+"</b></td><td>"+u+"</td><td>"+b+"</td></tr>"}a+="</table>",t?EJ_POPUP.fadeIn("<div id='show-rate-container'><div id='ej-popup-title'>Rate Details</div><div id='ej-popup-text'><div id='save-score-container'> <span id='save-score-show-score'>Your score is : <b>("+Score+")</b></span><div id='save-score-input-container'><input id='save-score-name-input' type='text' class='input' placeholder='Your Name'> <input id='save-score-submit-btn' class='btn' type='button' value='Submit'></div></div><div id='save-score-history-container'><span id='save-score-history-title'>History</span><div id='save-score-history'>"+a+"</div></div></div></div>"):EJ_POPUP.fadeIn("<div id='show-rate-container'><div id='ej-popup-title'>Rate Details</div><div id='ej-popup-text'><div id='save-score-container'> <span id='save-score-show-score'>Your score is : <b>("+Score+")</b></span></div><div id='save-score-history-container'><span id='save-score-history-title'>History</span><div id='save-score-history'>"+a+"</div></div></div></div>")}).fail(function(){alert(server_error_text)})}$(document).on("click","#high-score-btn",function(){t(!0)}),$(document).on("click","#save-score-submit-btn",function(){var o=$("#save-score-name-input").val()||"",e=Score,a=Lose,n=Level,i={name:o,score:e,lose:a,level:n};i=JSON.stringify(i),EJ_POPUP.loading(!1),$.post("",{set_rate_detail:i}).done(function(o){t(!1,o)}).fail(function(){alert(server_error_text)})}),$("#ej-popup-close-btn").click(function(){EJ_POPUP.isShow&&EJ_POPUP.fadeOut()}),$("#ej-popup-container").click(function(t){t.target.id==$(this).attr("id")&&EJ_POPUP.isShow&&EJ_POPUP.fadeOut()})});